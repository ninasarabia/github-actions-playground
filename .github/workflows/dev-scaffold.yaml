name: Build and deploy dev
on:
  push:
    branches:
      - "develop"
      - "master"

# Terraform jobs are queued per branch to prevent
# concurrent actions on the same Terraform workspace
concurrency: 
  group: ci-${{ github.ref }}

env:
  HEAD_COMMIT: ${{ github.sha }}

jobs:
  get-environment-name:
    name: "Extract environment name"
    runs-on: ubuntu-latest
    steps:
      - name: Get branch name
        id: branch-name
        uses: tj-actions/branch-names@v5.2
      - name: Current branch name
        run: |
          echo "Running on branch: ${{ steps.branch-name.outputs.current_branch }}"
      - name: Set environment to dev
        run: |
          echo "ENVIRONMENT=development" >> $GITHUB_ENV
        if: steps.branch-name.outputs.current_branch == "develop"
      - name: Set environment to staging
        run: |
          echo "ENVIRONMENT=staging" >> $GITHUB_ENV
        if: steps.branch-name.outputs.current_branch == "master"